# v00.01 - mwt-g

-----------------------------------------------------------
## AI INSTRUCTIONS

1. Only execute tasks marked with `[R]`.
  - `[ ]` indicates backlog (not yet ready to implement).
  - `[R]` indicates ready to implement in the current session.
  - `[I]` indicates the AI has implemented the code; set this once the work is completed in this session.
  - `[x]` indicates the user has signed off on the implementation.
1. Feature tracking is done using the format `Feature-00[ ]`
  - `[ ]` means that the feature has not been implemented.
  - `[I]` means that the feature is implemented. The AI shall annotate the feature description with the version that it was implemented in.
  - `[x]` is the human sign-off
1. Only mark a task or feature as done AFTER tests have passed
1. Do not excecute features without at least three tests to verify the implementation.

The prompt to execute the sequence will be
```
Review prompt v00.01.md and execute all implementation tasks marked with [R]
```

-----------------------------------------------------------
## APPLICATION SPECIFICATION

This section describes the application; it is not for execution purposes.

### Overview

mwt-g is a command-line tool for creating and launching URL aliases. It can be used within a project or installed globally.

### Features

- Custom URL scheme: `g:/<alias>` → `https://www.google.com/` (example)
- Settings are stored in:
  - A JSON file
  - Searched in the following order (first match wins):
    - Project-local: `./mwt-g/settings.json`
    - User-level: `~/.config/mwt-g/settings.json`

### Usage
- Feature-01[ ]: Adding an alias
  ```
  g g https://www.google.com
  ```


- Feature-02[ ]: Visiting the alias
  ```
  g y
  ```
  - Opens the user's default browser to `https://www.yahoo.com/`

- Feature-03[ ]: Adding an alias smartly
  ```
  g y yahoo
  ```
  - `y` is the alias name
  - If the second parameter is a bare keyword (no scheme), it resolves to `https://www.<param2>.com`

- Feature-04[ ]: Deep links
  ```
  g yn yahoo/news
  ```
  - `yn` is the alias name
  - Expands to `https://www.<param2>.com/news` → `https://www.yahoo.com/news`

- Feature-05[ ]: List aliases
  ```
  g +list
  ```
  - Lists all known aliases

- Feature-06[ ]: Choose navigation end-points
  ```
  g +b yn
  ```
  - `+b` will launch the URL into the registered browser.
  - `+c` will launch using Curl 
  - `+n` will display the URL for the user to click on.

- Feature-07[ ]: Register URL scheme
  ```
  g +register
  ```
  - Registers the custom `g:/` URL scheme with the OS so links like `g:/y` open via this tool

-----------------------------------------------------------
## Technical requirements

### MANDATORY

1. Only use PowerShell 7 for all scripting, whether it's the app or the tests.
2. The directory tree is $PROJECT_ROOT/mwt-g.
    - Create the following directories 
        - $PROJECT_ROOT/mwt-g/bin
        - $PROJECT_ROOT/mwt-g/tests
    - A separate promotion script will later move necessary content to the parent directory.

### Build Tool instructions
1. Build the tool using PowerShell 7, which should be available everywhere — Windows, macOS, and Linux.
1. Create the tool using best practices for portability — use Context7 to ensure that the most current documentation and best practices are adhered to.
1. Create the script as `mwt-g.ps1` in the `bin/` directory for this project.



-----------------------------------------------------------
## APPLICATION IMPLEMENTATION

### ALWAYS ###
- Maintain a `README.md` for the tool.
- Always write a test and always run the test after each session sequence.
- Only mark a task as `[x]` after the tests have been executed and passed.
- Perform syntax validation as a standard test.
- Maintain an application history prompts/HISTORY.md during each session
  - Note any tasks executed.
  - Note results of all tests.
  - Generate a commit message.
  - Summarize features.
- Testing:
  - Use Pester for all tests.
  - Ensure every test has a unique number T0000
  - Ensure that tests run indenpdently
  - For each test, assume a clean HOMEDIR with the following folder structure - testruns/YYYYMMDD-HHMMSS/TESTNUMBER/
  - For each test requested, annotate with the corresponding TESTNUMBER
  - All tests should be run from the mwt-g directory. testResults.xml should be in the testruns directory for that test run: testruns/YYYYMMDD-HHMMSS

### v00.01.01 
Create the initial version of the application as follows:

1. [x] Implement the ability to add a basic URL (`g g https://www.google.com`). [Feature-01] Implemented in v00.01.01
   - [x] add `+overwrite-alias` with `always`,`never`,`ask` options. Implemented in v00.01.01
   - [x] add `+quiet` to supress any messages. Implemented in v00.01.01
   - [x] app should display what it's doing (and why, if there are flags involved.) Implemented in v00.01.01
1. [x] Implement `+n` (display URL) and make it the default. [Feature-06] Implemented in v00.01.01
1. [x] Implement alias listing with `+list`. [Feature-05] Implemented in v00.01.01
1. [x] Rework the files:
       - [x] All configurations should be in configuration.toml (defaults respected by tool)
       - [x] All `+` options should be stored with defaults
           - [x] +overwrite-alias always
       - [x] Move the aliases to aliases.toml
        - [x] Create the configuration.toml file if it doesn't exist. Implemented in v00.01.01
1. [x] Implement tests using Pester
      - [x] `mwt-g g https://www.google.com` should add the alias to the settings file. [T0001]
      - [x] `mwt-g g` should display https://www.google.com [T0002]
      - [x] `mwt-g gg` throws an error [T0003]
      - [x] `mwt-g +list` should list all the aliases added [T0004]
      - [x] `mwt-g g https://news.google.com/` should overwrite the alias. Implemented in v00.01.01 [T0010]
       - [x] `mwt-g +quiet` should output nothing. [T0007]
       - [x] `mwt-g +overwrite-alias never g https://www.google.com` should refuse to overwrite the alias `g`. [T0006]
       - [I] `mwt-g +overwrite-alias always g https://www.gmail.com` should overwrite the alias `g`. Implemented in v00.01.01 [T0011]
       - [x] Test that the configuration file exists. Implemented in v00.01.01 [T0008]
      - [x] `mwt-g gx https://xxx.google.com/` should throw errors when trying to visit with 'mwt-g gx'. Implemented in v00.01.01 [T0012]

### v00.01.02
1. [x] Implement `+c` (fetch via curl). [Feature-06] Implemented in v00.01.02
1. [x] Implement tests using Pester
  - [x] Provide the tests a unique code T0000
    - `+c` fetch test: [T0009]


### v00.01.03
1. [X] Implement `+b` (open in browser). [Feature-06] 

### v00.01.04
1. [x] Implement bin/tests.ps1. Implemented in v00.01.04
    - [x] `-l --list`  list each test and what it does. Implemented in v00.01.04
    - [x] `-r --run <T1000>` run a specific by TESTNUMBER T0000. Implemented in v00.01.04
    - [x] `--runall-all` will run all tests. Implemented in v00.01.04

### v00.01.05
1. [x] Implement OS URL handler registration with `+register`. [Feature-07] Implemented in v00.01.05
  - [x] Once registered, a URL with the format `goto://<alias>` will invoke `mwt-g +b` to launch the underlying URL in the browser. Implemented in v00.01.05
  - [x] The registration path should be the path of the script, wherever it is. Implemented in v00.01.05
  - [x] Implement the tests using Pester. Implemented in v00.01.05
1. [x] Create bin/applescript-tool.ps1. Implemented in v00.01.05
      - [x] `-ClearCache` clear the cache. Implemented in v00.01.05
      - [x] `-Recompile` recompile the applescript. Implemented in v00.01.05
      - [x] `-OpenAlias` open goto://y. Implemented in v00.01.05
      - [x] `-TestScript` which will run `mwt-g-url-handler.applescript` from source.
1. [x] Update `mwt-g-url-handler.applescript`
      - [x] display a dialog showing the input parameters to the script.
1. [x] update Register-UrlSchemeHandler() in mwt-g.ps1 with the AppleScript template file "mwt-g-url-handler.applescript.template"
1. Implement tests using Pester
    - [x] Verify with the OS that `goto://` is indeed registered. Implemented in v00.01.05
    - [x] Verify that on a Mac, `open goto://y` does not return an error. Implemented in v00.01.05
    - [x] Fix T0018 - it should not be returning any text at all. Implemented in v00.01.05

### v00.01.06
1. [X] Update configuration file handling (Implemented in v00.01.06):
    - [X] On start up, look for configuration in the local directory in .config/mwt-g/
    - [X] If it doesn't exist, create it in $HOME
1. [X] Ensure that testResults.xml is moved into the appropriate testruns/ after each run. (Implemented in v00.01.06)
1. [X] when running tests/run-tests.ps1 - at the end, move the testResults.xml file into the testrun directory (Implemented in v00.01.06)
1. [X] if an alias is missing output a nice error messge rather throwing a PowerShell exception.
1. [R] only look in mwt-g in the current directory or ~/.config/mwt-g

### Future

1. [ ] Implement smart URL handling. [Feature-03]
1. [ ] Implement deep links. [Feature-04]

### Future
1. [ ] Implement visiting an alias baseline behavior (apply default action). [Feature-02]
1. [ ] Implement OS URL handler registration with `+register`. [Feature-07]


-----------------------------------------------------------
# IGNORE BELOW #



- Implement command line completions.
- Add long parameter names
- Add man page
- What other things should we be doing to make this a proper command line tool?
- Update settings handling
  - settings.json -> should contain application settings.
  - aliases should be in aliases.json or aliases.yaml
- mwt-g xxx -> instead of throwing an error should prompt for the URL. (or paste it from the copy-buffer)
- note when aliases were added or updated.
- update the parameter handling - not sure if I like the "+" syntax. also, it should be in keeping with PowerShell standards.